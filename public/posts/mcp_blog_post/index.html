<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>AI Integration: Building Conversational Apps with MCP | Mark Holton - Hands on Software Architect</title>
<meta name="keywords" content="AI, MCP, Python, FastAPI, PostgreSQL, Claude, Conversational AI">
<meta name="description" content="Learn how to build conversational AI applications using Model Context Protocol (MCP) to connect Claude directly to your FastAPI backend and PostgreSQL database.">
<meta name="author" content="Mark Holton">
<link rel="canonical" href="http://localhost:1313/posts/mcp_blog_post/">
<meta name="google-site-verification" content="YOUR_SEARCH_CONSOLE_TAG">
<meta name="yandex-verification" content="XYZabc">
<meta name="msvalidate.01" content="XYZabc">
<link crossorigin="anonymous" href="/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css" integrity="sha256-j&#43;ECM6cGvIfy4Is8&#43;XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/mcp_blog_post/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="http://localhost:1313/posts/mcp_blog_post/">
  <meta property="og:site_name" content="Mark Holton - Hands on Software Architect">
  <meta property="og:title" content="AI Integration: Building Conversational Apps with MCP">
  <meta property="og:description" content="Learn how to build conversational AI applications using Model Context Protocol (MCP) to connect Claude directly to your FastAPI backend and PostgreSQL database.">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-01-06T12:00:00-05:00">
    <meta property="article:modified_time" content="2025-01-06T12:00:00-05:00">
    <meta property="article:tag" content="AI">
    <meta property="article:tag" content="MCP">
    <meta property="article:tag" content="Python">
    <meta property="article:tag" content="FastAPI">
    <meta property="article:tag" content="PostgreSQL">
    <meta property="article:tag" content="Claude">
    <meta property="og:image" content="http://localhost:1313/images/building_pipelines.jpg">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://localhost:1313/images/building_pipelines.jpg">
<meta name="twitter:title" content="AI Integration: Building Conversational Apps with MCP">
<meta name="twitter:description" content="Learn how to build conversational AI applications using Model Context Protocol (MCP) to connect Claude directly to your FastAPI backend and PostgreSQL database.">
      <meta name="twitter:site" content="@markholton">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "AI Integration: Building Conversational Apps with MCP",
      "item": "http://localhost:1313/posts/mcp_blog_post/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "AI Integration: Building Conversational Apps with MCP",
  "name": "AI Integration: Building Conversational Apps with MCP",
  "description": "Learn how to build conversational AI applications using Model Context Protocol (MCP) to connect Claude directly to your FastAPI backend and PostgreSQL database.",
  "keywords": [
    "AI", "MCP", "Python", "FastAPI", "PostgreSQL", "Claude", "Conversational AI"
  ],
  "articleBody": "\nWhy This Matters: The Shift to Agentic AI The software landscape is shifting toward agentic AI systems - applications where Large Language Models (LLMs) don’t just answer questions, but actively use tools to solve complex problems. Instead of building separate AI features, the market and industry are moving toward AI that can directly interact with your existing systems, databases, and workflows.\nThis creates a fundamental challenge: how do you expose your application’s capabilities to an LLM? How do you let Claude, for instance, query your database, analyze the results or trigger your business logic - all through natural conversation?\nEnter the Model Context Protocol (MCP), open-sourced by Anthropic in November 2024. MCP provides a standardized way to connect any application to Claude (or other LLMs) through well-defined tools and protocols. Think of it as a bridge that lets your applications participate in AI conversations by exposing your functionality as tools.\nThis post walks through building a complete MCP integration - from a local FastAPI application with PostgreSQL (a personal “goal tracking” app) to a conversational interface where you can ask Claude to query your database, analyze trends, and even update records. You’ll see the practical patterns, common gotchas in setup, and why this approach represents a fundamental shift in how we build intelligent applications.\nThe goal isn’t just to add AI features to your app - it’s to make your entire application conversational and intelligent by design.\nThe Magic of MCP: Apps Meet Conversational AI Building conversational AI interfaces has been unlocked thanks to Anthropic’s Model Context Protocol (MCP). In this post, I’ll walk you through creating a local FastAPI application with PostgreSQL that Claude can interact with directly through structured tools - your local app talking to Claude Desktop. This demonstrates the core MCP integration patterns, and because we’re running everything locally, we won’t get bogged down with API keys, authentication, or hosting complexities.\nImagine asking Claude: “What goals do I have set up?” and having it query your PostgreSQL database, return structured data, and provide intelligent insights - all through a simple conversation. That’s a surface-level glimpse of the power of MCP.\nMCP bridges the gap between your applications and Claude’s conversational abilities by providing:\nStructured tool definitions that Claude can discover and use Type-safe data exchange through JSON schemas Real-time conversations with your actual application data Architecture Overview The stack here demonstrates a modern Python development pattern:\n1 2 3 Claude Desktop ↔ MCP Server ↔ FastAPI App ↔ PostgreSQL ↕ Pydantic Models (Type Safety) Key Components: Pydantic Models: Define data structure and automatic validation SQLAlchemy: ORM for PostgreSQL with relationship management FastAPI: REST API with auto-generated OpenAPI docs MCP Server: Bridge between Claude and your application PostgreSQL: Robust relational database with JSON support Project Structure 1 2 3 4 5 6 7 8 9 src/ ├── core/ │ ├── models/ # Pydantic data models │ ├── database/ # SQLAlchemy models and connection │ ├── api/ # FastAPI routes and app │ └── mcp/ # MCP server integration │ ├── server.py # Main MCP server │ ├── tools.py # Tool definitions for Claude │ └── handlers.py # Tool implementation logic Step 1: Pydantic Models for Type Safety Pydantic models serve as the single source of truth for your data structure:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 from pydantic import BaseModel, Field from typing import List, Optional from uuid import UUID from datetime import datetime class Goal(BaseModel): \"\"\"A specific, time-bound outcome to achieve.\"\"\" id: UUID = Field(default_factory=uuid4) title: str = Field(..., description=\"Clear, specific goal statement\") progress_percentage: float = Field(default=0.0, ge=0.0, le=100.0) status: str = Field(default=\"active\") created_at: datetime = Field(default_factory=datetime.utcnow) class GoalWithMetrics(Goal): \"\"\"Goal with nested metrics for rich responses.\"\"\" metrics: List[Metric] = Field(default_factory=list) Why this matters: These same models generate:\nDatabase schemas (via SQLAlchemy) API documentation (via FastAPI) MCP tool schemas (for Claude integration) Step 2: SQLAlchemy Database Models Map Pydantic models to database tables. This is the database layer that mirrors your Pydantic models. You’re defining the actual PostgreSQL table structure using SQLAlchemy’s ORM syntax.\nThe key pattern here is model mapping - your Goal Pydantic model becomes a GoalTable SQLAlchemy model with the same fields, but now with database-specific details like column types, constraints, and relationships.\nThe relationship(\"MetricTable\", back_populates=\"goal\") sets up the foreign key relationship so you can easily query goals with their associated metrics in one go.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 from sqlalchemy import Column, String, Float, DateTime from sqlalchemy.dialects.postgresql import UUID as PGUUID class GoalTable(Base): __tablename__ = \"goals\" id = Column(PGUUID(as_uuid=True), primary_key=True, default=uuid4) title = Column(String(200), nullable=False) progress_percentage = Column(Float, default=0.0) status = Column(String(20), default=\"active\") created_at = Column(DateTime(timezone=True), server_default=func.now()) # Relationships for complex queries metrics = relationship(\"MetricTable\", back_populates=\"goal\") Why this matters: You now have type-safe data models (Pydantic) that automatically generate both your API schemas and your database tables (SQLAlchemy), keeping everything in sync without manual duplication.\nDatabase migrations with Alembic handle schema evolution:\n1 2 3 4 5 # Generate migration from model changes poetry run alembic revision --autogenerate -m \"Add goals table\" # Apply migrations poetry run alembic upgrade head Step 3: FastAPI Routes Create REST endpoints that return Pydantic models:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 from fastapi import FastAPI, Depends from sqlalchemy.orm import Session app = FastAPI(title=\"Your Local App\") @app.get(\"/goals\", response_model=List[GoalWithMetrics]) async def get_goals(session: Session = Depends(get_session)): goals = session.query(GoalTable).all() # Convert SQLAlchemy to Pydantic with nested data return [ GoalWithMetrics.model_validate({ \"id\": goal.id, \"title\": goal.title, \"progress_percentage\": goal.progress_percentage, \"status\": goal.status, \"created_at\": goal.created_at, \"metrics\": [metric_to_dict(m) for m in goal.metrics] }) for goal in goals ] Step 4: MCP Tool Definitions Now we get to the fun part - defining tools that Claude can discover and use!\nHere we are creating a “menu” of tools that tells Claude exactly what it can use from your application. Each tool definition is like a menu item that specifies:\nThe name - get_goals What it does - “Get goals with their current progress” What options are available - status_filter, include_metrics The inputSchema is the detailed specification of those options - it tells Claude “you can filter by active, completed, or paused, and you can choose whether to include metrics (default is yes).”\nWhen Claude sees this menu, it knows exactly how to “order” from your app: it can ask for goals, specify which status it wants, and decide whether it needs the extra metric details. This is the contract between Claude and your application - Claude knows what’s possible, and your app knows what to expect:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 from mcp.types import Tool def get_goals_tool() -\u003e Tool: \"\"\"Tool for Claude to get goals with progress.\"\"\" return Tool( name=\"get_goals\", description=\"Get goals with their current progress and metrics\", inputSchema={ \"type\": \"object\", \"properties\": { \"status_filter\": { \"type\": \"string\", \"enum\": [\"active\", \"completed\", \"paused\"], \"description\": \"Filter goals by status\" }, \"include_metrics\": { \"type\": \"boolean\", \"description\": \"Whether to include metric details\", \"default\": True } } } ) Tip: Use Pydantic.model_json_schema() to auto-generate complex schemas:\n1 2 3 4 5 6 def create_goal_tool() -\u003e Tool: return Tool( name=\"create_goal\", description=\"Create a new goal\", inputSchema=Goal.model_json_schema() # Automatic schema generation! ) Step 5: MCP Server Implementation Create the server that bridges Claude and your app.\nThe MCP server has two main jobs:\n“Here’s what I can do” - When Claude asks “what tools are available?”, the list_tools() function responds with a menu: “I can get goals, create goals, and update goals.”\n“Let me do that for you” - When Claude says “please get my goals with status=active”, the call_tool() function:\nFigures out which specific function to call (handle_get_goals) Passes along Claude’s parameters ({\"status\": \"active\"}) Runs your database code Sends the results back to Claude as text The run_mcp_server() function starts up this “translator” and keeps it running, listening for Claude’s requests through standard input/output (like a command-line program).\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 from mcp.server import Server from mcp.types import TextContent from mcp.server.stdio import stdio_server def create_server(): server = Server(\"your-app-name\") @server.list_tools() async def list_tools(): return [get_goals_tool(), create_goal_tool(), update_goal_tool()] @server.call_tool() async def call_tool(name: str, arguments: dict): try: if name == \"get_goals\": result = await handle_get_goals(arguments) elif name == \"create_goal\": result = await handle_create_goal(arguments) # ... other tools return [TextContent(type=\"text\", text=result)] except Exception as e: # Error handling - shows up in Claude logs print(f\"Error in tool {name}: {str(e)}\", file=sys.stderr) return [TextContent(type=\"text\", text=f\"Error: {str(e)}\")] return server async def run_mcp_server(): server = create_server() async with stdio_server() as (read_stream, write_stream): await server.run(read_stream, write_stream, server.create_initialization_options()) Step 6: Tool Implementation with Database Integration Here we are creating the bridge between MCP and the database by:\nExtracting parameters from Claude’s tool call (like filtering and options) Querying your database using standard SQLAlchemy patterns with optional filtering Converting SQLAlchemy objects to plain dictionaries for JSON serialization Optionally loading related data (metrics) based on the include_metrics flag Returning structured JSON that Claude can understand and work with Essentially, you’re translating between Claude’s conversational requests and your database’s structured data - taking natural language tool calls and turning them into database queries, then formatting the results back into something Claude can interpret and discuss with the user.\nThe pattern is: MCP tool call → database query → JSON response\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 async def handle_get_goals(arguments: dict) -\u003e str: status_filter = arguments.get(\"status_filter\") include_metrics = arguments.get(\"include_metrics\", True) # Use your existing database session session = next(get_session()) try: query = session.query(GoalTable) if status_filter: query = query.filter(GoalTable.status == status_filter) goals = query.order_by(GoalTable.created_at).all() # Convert to Pydantic for validation and serialization goal_objects = [] for goal in goals: goal_data = { \"id\": str(goal.id), \"title\": goal.title, \"progress_percentage\": goal.progress_percentage, \"status\": goal.status, \"metrics\": [] } if include_metrics: metrics = session.query(MetricTable).filter( MetricTable.goal_id == goal.id ).all() goal_data[\"metrics\"] = [metric_to_dict(m) for m in metrics] goal_objects.append(goal_data) # Return formatted JSON for Claude return json.dumps(goal_objects, indent=2) finally: session.close() Step 7: Claude Desktop Configuration Configure Claude Desktop to connect to your MCP server:\nThis step instructs Claude Desktop on where to locate your MCP server. You’re adding an entry to Claude’s configuration file that specifies:\nWhat to call - the command to start your MCP server Where to run it - the working directory for your project How to identify it - a name Claude uses to reference this server Once configured, Claude Desktop will automatically start your MCP server when it launches and connect to it for tool access. The result: Claude can now discover and use the tools you defined in previous steps.\nFile: ~/Library/Application Support/Claude/claude_desktop_config.json\n1 2 3 4 5 6 7 8 9 { \"mcpServers\": { \"your-app-name\": { \"command\": \"/bin/bash\", \"args\": [\"-c\", \"cd /path/to/your/project \u0026\u0026 poetry run python -m src.core.mcp.server\"], \"cwd\": \"/path/to/your/project\" } } } This follows the official MCP configuration pattern documented by Anthropic. Key points:\nUse absolute paths for reliability Ensure proper working directory with cwd Use bash wrapper to handle environment setup Note: In a production environment, you’d typically have your own AI agent or application connecting to the MCP server. Here, Claude Desktop acts as our “agent” - it discovers your MCP server on startup and makes the tools available through the chat interface. This local setup enables you to quickly explore MCP integrations before integrating them into larger systems.\nBONUS: CLI Integration for Easy Management Create a CLI for managing your servers:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 import typer import uvicorn import asyncio app = typer.Typer() @app.command() def start_api(): \"\"\"Start the FastAPI server.\"\"\" uvicorn.run(\"src.core.api.app:app\", host=\"127.0.0.1\", port=8000, reload=True) @app.command() def start_mcp(): \"\"\"Start the MCP server for Claude.\"\"\" from .mcp.server import run_mcp_server asyncio.run(run_mcp_server()) @app.command() def migrate(): \"\"\"Run database migrations.\"\"\" subprocess.run([\"alembic\", \"upgrade\", \"head\"]) Usage:\n1 2 3 poetry run your-app start-api # FastAPI server poetry run your-app start-mcp # MCP server poetry run your-app migrate # Database migrations The Result: Conversational Database Interactions Once everything is connected, you can have natural conversations with your data:\nYou: “What are my 3 most recent goals?”\nClaude: Looking at your goals, your 3 most recent goals appear to be:\n[Calls get_goals with status_filter=“active”, include_metrics=true]\nClaude calls the get_goals tool and then analyzes the results to identify the 3 most recently created goals.\nClaude: *Based on your current goals, I found 3 that might need attention.\nYou could enhance your tool definition to include:\nlimit parameter (number of results to return) sort_by parameter (“created_at”, “updated_at”, etc.) That would make the call: [Calls get_goals with limit=3, sort_by=“created_at”, include_metrics=true]\nAdvanced Patterns Rich Insights with Cross-Domain Analysis Leverage Claude’s analytical capabilities:\nInstead of asking Claude to run individual queries (“show me my goals”, “show me my metrics”), you’re giving it rich, interconnected data and letting it find patterns and insights you might miss.\nThe analytical leap:\nRaw approach: “What are my goals?” → Claude returns a list Rich approach: “Here’s my goals, metrics, and recent activity - what insights do you see?” → Claude identifies trends, correlations, and recommendations Concrete example: Claude might notice: “Your deadlift goal is at 15% progress, but I see you haven’t logged any gym sessions in 3 weeks, and your recent check-ins show you’ve been deep in learning new technologies. These might be connected - your intense focus on skill development may be crowding out your strength training routine.”\nWhy this is powerful:\nCross-domain thinking - Claude can spot relationships between different life areas Pattern recognition - Finds trends across time and different data types Proactive insights - Suggests what to focus on rather than just reporting status Strategic recommendations - Not just “what happened” but “what should I do next” By connecting the goals app to the LLM, you’ve essentially transformed a logging and metrics app into an AI-powered personal strategist that can see the whole picture and help you make better decisions about where to focus your energy.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 async def handle_progress_summary(arguments: dict) -\u003e str: # Gather data from multiple tables goals = get_goals_data() metrics = get_metrics_data() recent_activity = get_recent_checkins() # Return rich data for Claude to analyze return json.dumps({ \"goals\": goals, \"metrics\": metrics, \"recent_activity\": recent_activity, \"suggested_insights\": [ \"Cross-reference goal progress with activity patterns\", \"Identify goals that haven't been updated recently\", \"Find correlation between metrics and goal completion\" ] }) Multiple MCP Servers You can run multiple MCP servers for different domains:\nComposability - you can connect multiple specialized servers to Claude simultaneously. Each server can focus on a different domain (your main app, analytics, financial data, etc.), and Claude can use tools from all of them in a single conversation.\nInstead of building one monolithic MCP server, you can create focused, single-purpose servers that Claude orchestrates together. Ask Claude to “analyze my goals progress and compare it with my financial metrics” - it seamlessly pulls from multiple apps to give you cross-system insights.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 { \"mcpServers\": { \"main-app\": { \"command\": \"poetry\", \"args\": [\"run\", \"main-app\", \"start-mcp\"], \"cwd\": \"/path/to/main/app\" }, \"analytics-app\": { \"command\": \"poetry\", \"args\": [\"run\", \"analytics\", \"start-mcp\"], \"cwd\": \"/path/to/analytics/app\" } } } Streaming Responses for Large Data For large datasets, consider streaming responses:\n1 2 3 4 5 6 7 8 9 10 11 12 13 async def handle_large_query(arguments: dict) -\u003e str: # Process in chunks results = [] for chunk in process_in_batches(query_data(arguments)): results.extend(chunk) if len(results) \u003e 1000: # Limit response size break return json.dumps({ \"results\": results, \"truncated\": len(results) \u003e= 1000, \"total_available\": get_total_count(arguments) }) Common Issues and Solutions 1. “Poetry could not find pyproject.toml” Error: MCP server can’t find your project files.\nSolution: Configuration probably has the wrong directory. Use shell wrapper with explicit directory change:\n1 2 3 4 { \"command\": \"/bin/bash\", \"args\": [\"-c\", \"cd /full/path/to/project \u0026\u0026 poetry run your-command\"] } 2. “relation ’table_name’ does not exist” Error: Database tables not created.\nSolution: You likely forgot to run a migration - run migrations before starting MCP server:\n1 poetry run alembic upgrade head 3. JSON Parsing Errors in Claude Logs Error: Unexpected non-whitespace character after JSON\nCause: SQLAlchemy debug output mixing with JSON responses.\nSolution: Either disable SQLAlchemy echo or ignore these warnings:\n1 engine = create_engine(DATABASE_URL, echo=False) # Disable in production 4. Module Import Warnings Warning: RuntimeWarning: ‘module’ found in sys.modules\nSolution: This warning is harmless when running MCP servers. It occurs due to Python’s module loading order but doesn’t affect functionality.\nDebugging MCP Connections View MCP logs:\n1 tail -f ~/Library/Logs/Claude/mcp-server-your-app-name.log Test MCP server manually:\n1 2 3 cd /your/project/path poetry run python -m src.core.mcp.server # Should wait for input without errors Add debug output to MCP handlers:\n1 2 3 4 5 6 7 8 9 10 async def handle_tool(arguments: dict) -\u003e str: try: # Your logic here result = process_data(arguments) return json.dumps(result) except Exception as e: # This appears in Claude logs print(f\"Debug: Tool failed with {arguments}\", file=sys.stderr) print(f\"Error: {str(e)}\", file=sys.stderr) return f\"Error: {str(e)}\" Conclusion Building MCP-enabled applications opens up imaginative possibilities for AI interactions and augmentation - transforming static applications into intelligent partners that can analyze, strategize, and evolve with your needs. The combination of Pydantic’s type safety, FastAPI’s performance, PostgreSQL’s robustness, and MCP’s conversational interface creates a powerful foundation for intelligent applications.\nKey takeaways: Pydantic models provide type safety across your entire stack MCP integration is surprisingly straightforward once you understand the stdio communication pattern Error handling and logging are crucial for debugging MCP connections The development experience is smooth with proper tooling and CLI commands Standardized AI integration - MCP provides the protocol layer that lets any LLM interact with your applications through well-defined tools The result is a system that enables natural conversations with your data, allows you to create complex queries through simple language, and provides intelligent insights.\nNext steps: The patterns demonstrated here extend naturally to production environments with proper authentication, advanced tool chaining, and rich user interfaces. The future of AI application development leverages LLM advances to unlock the full potential of our applications, transforming them from static data repositories with APIs into dynamic, intelligent partners.\nBuilt with: Python 3.12, FastAPI, PostgreSQL, Pydantic, SQLAlchemy, Alembic, and Anthropic’s MCP\nAbout the Author: Mark Holton is a hands-on Software Architect at ShiftUp, where we’re building AI agents that revolutionize Go To Market and Sales Intelligence.\nOriginally published to Medium: https://markholton.medium.com/ai-integration-building-conversational-apps-with-mcp-f47a487009f5\n",
  "wordCount" : "3118",
  "inLanguage": "en",
  "image":"http://localhost:1313/images/building_pipelines.jpg","datePublished": "2025-01-06T12:00:00-05:00",
  "dateModified": "2025-01-06T12:00:00-05:00",
  "author":{
    "@type": "Person",
    "name": "Mark Holton"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/posts/mcp_blog_post/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Mark Holton - Hands on Software Architect",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Mark Holton - Software Architecture (Alt + H)">
                <img src="http://localhost:1313/apple-touch-icon.png" alt="" aria-label="logo"
                    height="35">Mark Holton - Software Architecture</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/posts/" title="Posts">
                    <span>Posts</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about/" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;»&nbsp;<a href="http://localhost:1313/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      AI Integration: Building Conversational Apps with MCP
    </h1>
    <div class="post-description">
      Learn how to build conversational AI applications using Model Context Protocol (MCP) to connect Claude directly to your FastAPI backend and PostgreSQL database.
    </div>
    <div class="post-meta"><span title='2025-01-06 12:00:00 -0500 EST'>January 6, 2025</span>&nbsp;·&nbsp;15 min&nbsp;·&nbsp;3118 words&nbsp;·&nbsp;Mark Holton&nbsp;|&nbsp;<a href="https://github.com/holtonma/holtonma.github.io/tree/main/content/posts/mcp_blog_post.md" rel="noopener noreferrer edit" target="_blank">Suggest Changes</a>

</div>
  </header> 
  <div class="post-content"><p><img alt="AI Integration with Data Pipelines" loading="lazy" src="/images/building_pipelines.jpg"></p>
<h2 id="why-this-matters-the-shift-to-agentic-ai">Why This Matters: The Shift to Agentic AI<a hidden class="anchor" aria-hidden="true" href="#why-this-matters-the-shift-to-agentic-ai">#</a></h2>
<p>The software landscape is shifting toward agentic AI systems - applications where Large Language Models (LLMs) don&rsquo;t just answer questions, but actively use tools to solve complex problems. Instead of building separate AI features, the market and industry are moving toward AI that can directly interact with your existing systems, databases, and workflows.</p>
<p>This creates a fundamental challenge: how do you expose your application&rsquo;s capabilities to an LLM? How do you let Claude, for instance, query your database, analyze the results or trigger your business logic - all through natural conversation?</p>
<p>Enter the <strong>Model Context Protocol (MCP)</strong>, open-sourced by Anthropic in November 2024. MCP provides a standardized way to connect any application to Claude (or other LLMs) through well-defined tools and protocols. Think of it as a bridge that lets your applications participate in AI conversations by exposing your functionality as tools.</p>
<p>This post walks through building a complete MCP integration - from a local FastAPI application with PostgreSQL (a personal &ldquo;goal tracking&rdquo; app) to a conversational interface where you can ask Claude to query your database, analyze trends, and even update records. You&rsquo;ll see the practical patterns, common gotchas in setup, and why this approach represents a fundamental shift in how we build intelligent applications.</p>
<p><strong>The goal isn&rsquo;t just to add AI features to your app - it&rsquo;s to make your entire application conversational and intelligent by design.</strong></p>
<h2 id="the-magic-of-mcp-apps-meet-conversational-ai">The Magic of MCP: Apps Meet Conversational AI<a hidden class="anchor" aria-hidden="true" href="#the-magic-of-mcp-apps-meet-conversational-ai">#</a></h2>
<p>Building conversational AI interfaces has been unlocked thanks to Anthropic&rsquo;s Model Context Protocol (MCP). In this post, I&rsquo;ll walk you through creating a local FastAPI application with PostgreSQL that Claude can interact with directly through structured tools - your local app talking to Claude Desktop. This demonstrates the core MCP integration patterns, and because we&rsquo;re running everything locally, we won&rsquo;t get bogged down with API keys, authentication, or hosting complexities.</p>
<p>Imagine asking Claude: &ldquo;What goals do I have set up?&rdquo; and having it query your PostgreSQL database, return structured data, and provide intelligent insights - all through a simple conversation. That&rsquo;s a surface-level glimpse of the power of MCP.</p>
<p>MCP bridges the gap between your applications and Claude&rsquo;s conversational abilities by providing:</p>
<ul>
<li><strong>Structured tool definitions</strong> that Claude can discover and use</li>
<li><strong>Type-safe data exchange</strong> through JSON schemas</li>
<li><strong>Real-time conversations</strong> with your actual application data</li>
</ul>
<h2 id="architecture-overview">Architecture Overview<a hidden class="anchor" aria-hidden="true" href="#architecture-overview">#</a></h2>
<p>The stack here demonstrates a modern Python development pattern:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Claude Desktop ↔ MCP Server ↔ FastAPI App ↔ PostgreSQL
</span></span><span class="line"><span class="cl">                     ↕
</span></span><span class="line"><span class="cl">               Pydantic Models (Type Safety)
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="key-components">Key Components:<a hidden class="anchor" aria-hidden="true" href="#key-components">#</a></h3>
<ul>
<li><strong>Pydantic Models</strong>: Define data structure and automatic validation</li>
<li><strong>SQLAlchemy</strong>: ORM for PostgreSQL with relationship management</li>
<li><strong>FastAPI</strong>: REST API with auto-generated OpenAPI docs</li>
<li><strong>MCP Server</strong>: Bridge between Claude and your application</li>
<li><strong>PostgreSQL</strong>: Robust relational database with JSON support</li>
</ul>
<h2 id="project-structure">Project Structure<a hidden class="anchor" aria-hidden="true" href="#project-structure">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">src</span><span class="o">/</span>
</span></span><span class="line"><span class="cl"><span class="err">├──</span> <span class="n">core</span><span class="o">/</span>
</span></span><span class="line"><span class="cl"><span class="err">│</span>   <span class="err">├──</span> <span class="n">models</span><span class="o">/</span>         <span class="c1"># Pydantic data models</span>
</span></span><span class="line"><span class="cl"><span class="err">│</span>   <span class="err">├──</span> <span class="n">database</span><span class="o">/</span>       <span class="c1"># SQLAlchemy models and connection</span>
</span></span><span class="line"><span class="cl"><span class="err">│</span>   <span class="err">├──</span> <span class="n">api</span><span class="o">/</span>            <span class="c1"># FastAPI routes and app</span>
</span></span><span class="line"><span class="cl"><span class="err">│</span>   <span class="err">└──</span> <span class="n">mcp</span><span class="o">/</span>            <span class="c1"># MCP server integration</span>
</span></span><span class="line"><span class="cl"><span class="err">│</span>       <span class="err">├──</span> <span class="n">server</span><span class="o">.</span><span class="n">py</span>   <span class="c1"># Main MCP server</span>
</span></span><span class="line"><span class="cl"><span class="err">│</span>       <span class="err">├──</span> <span class="n">tools</span><span class="o">.</span><span class="n">py</span>    <span class="c1"># Tool definitions for Claude</span>
</span></span><span class="line"><span class="cl"><span class="err">│</span>       <span class="err">└──</span> <span class="n">handlers</span><span class="o">.</span><span class="n">py</span> <span class="c1"># Tool implementation logic</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="step-1-pydantic-models-for-type-safety">Step 1: Pydantic Models for Type Safety<a hidden class="anchor" aria-hidden="true" href="#step-1-pydantic-models-for-type-safety">#</a></h2>
<p>Pydantic models serve as the single source of truth for your data structure:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">uuid</span> <span class="kn">import</span> <span class="n">UUID</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Goal</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;A specific, time-bound outcome to achieve.&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">uuid4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&#34;Clear, specific goal statement&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">progress_percentage</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mf">100.0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">status</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&#34;active&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">created_at</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">GoalWithMetrics</span><span class="p">(</span><span class="n">Goal</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Goal with nested metrics for rich responses.&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">metrics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Metric</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Why this matters</strong>: These same models generate:</p>
<ul>
<li>Database schemas (via SQLAlchemy)</li>
<li>API documentation (via FastAPI)</li>
<li>MCP tool schemas (for Claude integration)</li>
</ul>
<h2 id="step-2-sqlalchemy-database-models">Step 2: SQLAlchemy Database Models<a hidden class="anchor" aria-hidden="true" href="#step-2-sqlalchemy-database-models">#</a></h2>
<p>Map Pydantic models to database tables. This is the database layer that mirrors your Pydantic models. You&rsquo;re defining the actual PostgreSQL table structure using SQLAlchemy&rsquo;s ORM syntax.</p>
<p>The key pattern here is <strong>model mapping</strong> - your <code>Goal</code> Pydantic model becomes a <code>GoalTable</code> SQLAlchemy model with the same fields, but now with database-specific details like column types, constraints, and relationships.</p>
<p>The <code>relationship(&quot;MetricTable&quot;, back_populates=&quot;goal&quot;)</code> sets up the foreign key relationship so you can easily query goals with their associated metrics in one go.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Column</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">Float</span><span class="p">,</span> <span class="n">DateTime</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sqlalchemy.dialects.postgresql</span> <span class="kn">import</span> <span class="n">UUID</span> <span class="k">as</span> <span class="n">PGUUID</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">GoalTable</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&#34;goals&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">PGUUID</span><span class="p">(</span><span class="n">as_uuid</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">uuid4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">title</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">200</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">progress_percentage</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">status</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="s2">&#34;active&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">created_at</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">DateTime</span><span class="p">(</span><span class="n">timezone</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">server_default</span><span class="o">=</span><span class="n">func</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Relationships for complex queries</span>
</span></span><span class="line"><span class="cl">    <span class="n">metrics</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&#34;MetricTable&#34;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s2">&#34;goal&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Why this matters</strong>: You now have type-safe data models (Pydantic) that automatically generate both your API schemas and your database tables (SQLAlchemy), keeping everything in sync without manual duplication.</p>
<p>Database migrations with Alembic handle schema evolution:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Generate migration from model changes</span>
</span></span><span class="line"><span class="cl">poetry run alembic revision --autogenerate -m <span class="s2">&#34;Add goals table&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Apply migrations</span>
</span></span><span class="line"><span class="cl">poetry run alembic upgrade head
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="step-3-fastapi-routes">Step 3: FastAPI Routes<a hidden class="anchor" aria-hidden="true" href="#step-3-fastapi-routes">#</a></h2>
<p>Create REST endpoints that return Pydantic models:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span><span class="p">,</span> <span class="n">Depends</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">Session</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&#34;Your Local App&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.get</span><span class="p">(</span><span class="s2">&#34;/goals&#34;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">List</span><span class="p">[</span><span class="n">GoalWithMetrics</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">get_goals</span><span class="p">(</span><span class="n">session</span><span class="p">:</span> <span class="n">Session</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_session</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">    <span class="n">goals</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">GoalTable</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Convert SQLAlchemy to Pydantic with nested data</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="n">GoalWithMetrics</span><span class="o">.</span><span class="n">model_validate</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;id&#34;</span><span class="p">:</span> <span class="n">goal</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;title&#34;</span><span class="p">:</span> <span class="n">goal</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;progress_percentage&#34;</span><span class="p">:</span> <span class="n">goal</span><span class="o">.</span><span class="n">progress_percentage</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="n">goal</span><span class="o">.</span><span class="n">status</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;created_at&#34;</span><span class="p">:</span> <span class="n">goal</span><span class="o">.</span><span class="n">created_at</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;metrics&#34;</span><span class="p">:</span> <span class="p">[</span><span class="n">metric_to_dict</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">goal</span><span class="o">.</span><span class="n">metrics</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">goal</span> <span class="ow">in</span> <span class="n">goals</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="step-4-mcp-tool-definitions">Step 4: MCP Tool Definitions<a hidden class="anchor" aria-hidden="true" href="#step-4-mcp-tool-definitions">#</a></h2>
<p>Now we get to the fun part - defining tools that Claude can discover and use!</p>
<p>Here we are creating a &ldquo;menu&rdquo; of tools that tells Claude exactly what it can use from your application. Each tool definition is like a menu item that specifies:</p>
<ul>
<li><strong>The name</strong> - <code>get_goals</code></li>
<li><strong>What it does</strong> - &ldquo;Get goals with their current progress&rdquo;</li>
<li><strong>What options are available</strong> - <code>status_filter</code>, <code>include_metrics</code></li>
</ul>
<p>The <code>inputSchema</code> is the detailed specification of those options - it tells Claude &ldquo;you can filter by active, completed, or paused, and you can choose whether to include metrics (default is yes).&rdquo;</p>
<p>When Claude sees this menu, it knows exactly how to &ldquo;order&rdquo; from your app: it can ask for goals, specify which status it wants, and decide whether it needs the extra metric details. This is the contract between Claude and your application - Claude knows what&rsquo;s possible, and your app knows what to expect:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">mcp.types</span> <span class="kn">import</span> <span class="n">Tool</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_goals_tool</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Tool</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Tool for Claude to get goals with progress.&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">Tool</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">name</span><span class="o">=</span><span class="s2">&#34;get_goals&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">description</span><span class="o">=</span><span class="s2">&#34;Get goals with their current progress and metrics&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">inputSchema</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;object&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;status_filter&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;string&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;enum&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;active&#34;</span><span class="p">,</span> <span class="s2">&#34;completed&#34;</span><span class="p">,</span> <span class="s2">&#34;paused&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Filter goals by status&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="p">},</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;include_metrics&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;boolean&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Whether to include metric details&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;default&#34;</span><span class="p">:</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Tip</strong>: Use <code>Pydantic.model_json_schema()</code> to auto-generate complex schemas:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">create_goal_tool</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Tool</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">Tool</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">name</span><span class="o">=</span><span class="s2">&#34;create_goal&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">        <span class="n">description</span><span class="o">=</span><span class="s2">&#34;Create a new goal&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">inputSchema</span><span class="o">=</span><span class="n">Goal</span><span class="o">.</span><span class="n">model_json_schema</span><span class="p">()</span>  <span class="c1"># Automatic schema generation!</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="step-5-mcp-server-implementation">Step 5: MCP Server Implementation<a hidden class="anchor" aria-hidden="true" href="#step-5-mcp-server-implementation">#</a></h2>
<p>Create the server that bridges Claude and your app.</p>
<p><img alt="MCP Integration Vision" loading="lazy" src="/images/mcp_cartoon.webp"></p>
<p>The MCP server has two main jobs:</p>
<ol>
<li>
<p><strong>&ldquo;Here&rsquo;s what I can do&rdquo;</strong> - When Claude asks &ldquo;what tools are available?&rdquo;, the <code>list_tools()</code> function responds with a menu: &ldquo;I can get goals, create goals, and update goals.&rdquo;</p>
</li>
<li>
<p><strong>&ldquo;Let me do that for you&rdquo;</strong> - When Claude says &ldquo;please get my goals with status=active&rdquo;, the <code>call_tool()</code> function:</p>
<ul>
<li>Figures out which specific function to call (<code>handle_get_goals</code>)</li>
<li>Passes along Claude&rsquo;s parameters (<code>{&quot;status&quot;: &quot;active&quot;}</code>)</li>
<li>Runs your database code</li>
<li>Sends the results back to Claude as text</li>
</ul>
</li>
</ol>
<p><img alt="Goal Tracking Example" loading="lazy" src="/images/get_goals.webp"></p>
<p>The <code>run_mcp_server()</code> function starts up this &ldquo;translator&rdquo; and keeps it running, listening for Claude&rsquo;s requests through standard input/output (like a command-line program).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">mcp.server</span> <span class="kn">import</span> <span class="n">Server</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">mcp.types</span> <span class="kn">import</span> <span class="n">TextContent</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">mcp.server.stdio</span> <span class="kn">import</span> <span class="n">stdio_server</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">create_server</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">server</span> <span class="o">=</span> <span class="n">Server</span><span class="p">(</span><span class="s2">&#34;your-app-name&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nd">@server.list_tools</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">async</span> <span class="k">def</span> <span class="nf">list_tools</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">[</span><span class="n">get_goals_tool</span><span class="p">(),</span> <span class="n">create_goal_tool</span><span class="p">(),</span> <span class="n">update_goal_tool</span><span class="p">()]</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nd">@server.call_tool</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">async</span> <span class="k">def</span> <span class="nf">call_tool</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&#34;get_goals&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">handle_get_goals</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&#34;create_goal&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">handle_create_goal</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># ... other tools</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">[</span><span class="n">TextContent</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&#34;text&#34;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">result</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Error handling - shows up in Claude logs</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Error in tool </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">[</span><span class="n">TextContent</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&#34;text&#34;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&#34;Error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">server</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">run_mcp_server</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">server</span> <span class="o">=</span> <span class="n">create_server</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">async</span> <span class="k">with</span> <span class="n">stdio_server</span><span class="p">()</span> <span class="k">as</span> <span class="p">(</span><span class="n">read_stream</span><span class="p">,</span> <span class="n">write_stream</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">await</span> <span class="n">server</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">read_stream</span><span class="p">,</span> <span class="n">write_stream</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                        <span class="n">server</span><span class="o">.</span><span class="n">create_initialization_options</span><span class="p">())</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="step-6-tool-implementation-with-database-integration">Step 6: Tool Implementation with Database Integration<a hidden class="anchor" aria-hidden="true" href="#step-6-tool-implementation-with-database-integration">#</a></h2>
<p>Here we are creating the bridge between MCP and the database by:</p>
<ul>
<li>Extracting parameters from Claude&rsquo;s tool call (like filtering and options)</li>
<li>Querying your database using standard SQLAlchemy patterns with optional filtering</li>
<li>Converting SQLAlchemy objects to plain dictionaries for JSON serialization</li>
<li>Optionally loading related data (metrics) based on the <code>include_metrics</code> flag</li>
<li>Returning structured JSON that Claude can understand and work with</li>
</ul>
<p>Essentially, you&rsquo;re translating between Claude&rsquo;s conversational requests and your database&rsquo;s structured data - taking natural language tool calls and turning them into database queries, then formatting the results back into something Claude can interpret and discuss with the user.</p>
<p><strong>The pattern is</strong>: MCP tool call → database query → JSON response</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">handle_get_goals</span><span class="p">(</span><span class="n">arguments</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">status_filter</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;status_filter&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">include_metrics</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;include_metrics&#34;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Use your existing database session</span>
</span></span><span class="line"><span class="cl">    <span class="n">session</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">get_session</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">query</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">GoalTable</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">status_filter</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">GoalTable</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">status_filter</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="n">goals</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">GoalTable</span><span class="o">.</span><span class="n">created_at</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Convert to Pydantic for validation and serialization</span>
</span></span><span class="line"><span class="cl">        <span class="n">goal_objects</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">goal</span> <span class="ow">in</span> <span class="n">goals</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">goal_data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;id&#34;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">goal</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;title&#34;</span><span class="p">:</span> <span class="n">goal</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;progress_percentage&#34;</span><span class="p">:</span> <span class="n">goal</span><span class="o">.</span><span class="n">progress_percentage</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="n">goal</span><span class="o">.</span><span class="n">status</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;metrics&#34;</span><span class="p">:</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">include_metrics</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">metrics</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">MetricTable</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="n">MetricTable</span><span class="o">.</span><span class="n">goal_id</span> <span class="o">==</span> <span class="n">goal</span><span class="o">.</span><span class="n">id</span>
</span></span><span class="line"><span class="cl">                <span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="n">goal_data</span><span class="p">[</span><span class="s2">&#34;metrics&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">metric_to_dict</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">metrics</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="n">goal_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">goal_data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Return formatted JSON for Claude</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">goal_objects</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="k">finally</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="step-7-claude-desktop-configuration">Step 7: Claude Desktop Configuration<a hidden class="anchor" aria-hidden="true" href="#step-7-claude-desktop-configuration">#</a></h2>
<p>Configure Claude Desktop to connect to your MCP server:</p>
<p>This step instructs Claude Desktop on where to locate your MCP server. You&rsquo;re adding an entry to Claude&rsquo;s configuration file that specifies:</p>
<ul>
<li><strong>What to call</strong> - the command to start your MCP server</li>
<li><strong>Where to run it</strong> - the working directory for your project</li>
<li><strong>How to identify it</strong> - a name Claude uses to reference this server</li>
</ul>
<p>Once configured, Claude Desktop will automatically start your MCP server when it launches and connect to it for tool access. The result: Claude can now discover and use the tools you defined in previous steps.</p>
<p><strong>File</strong>: <code>~/Library/Application Support/Claude/claude_desktop_config.json</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;mcpServers&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;your-app-name&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;command&#34;</span><span class="p">:</span> <span class="s2">&#34;/bin/bash&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;args&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;-c&#34;</span><span class="p">,</span> <span class="s2">&#34;cd /path/to/your/project &amp;&amp; poetry run python -m src.core.mcp.server&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;cwd&#34;</span><span class="p">:</span> <span class="s2">&#34;/path/to/your/project&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This follows the official MCP configuration pattern documented by Anthropic. Key points:</p>
<ul>
<li>Use absolute paths for reliability</li>
<li>Ensure proper working directory with <code>cwd</code></li>
<li>Use bash wrapper to handle environment setup</li>
</ul>
<p><img alt="Claude MCP Integration" loading="lazy" src="/images/claude_mcp.webp"></p>
<p><strong>Note</strong>: In a production environment, you&rsquo;d typically have your own AI agent or application connecting to the MCP server. Here, Claude Desktop acts as our &ldquo;agent&rdquo; - it discovers your MCP server on startup and makes the tools available through the chat interface. This local setup enables you to quickly explore MCP integrations before integrating them into larger systems.</p>
<h2 id="bonus-cli-integration-for-easy-management">BONUS: CLI Integration for Easy Management<a hidden class="anchor" aria-hidden="true" href="#bonus-cli-integration-for-easy-management">#</a></h2>
<p>Create a CLI for managing your servers:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">typer</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">uvicorn</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">asyncio</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Typer</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.command</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">start_api</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Start the FastAPI server.&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">uvicorn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&#34;src.core.api.app:app&#34;</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s2">&#34;127.0.0.1&#34;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8000</span><span class="p">,</span> <span class="n">reload</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.command</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">start_mcp</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Start the MCP server for Claude.&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">from</span> <span class="nn">.mcp.server</span> <span class="kn">import</span> <span class="n">run_mcp_server</span>
</span></span><span class="line"><span class="cl">    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">run_mcp_server</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.command</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">migrate</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Run database migrations.&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&#34;alembic&#34;</span><span class="p">,</span> <span class="s2">&#34;upgrade&#34;</span><span class="p">,</span> <span class="s2">&#34;head&#34;</span><span class="p">])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Usage</strong>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">poetry run your-app start-api    <span class="c1"># FastAPI server</span>
</span></span><span class="line"><span class="cl">poetry run your-app start-mcp    <span class="c1"># MCP server</span>
</span></span><span class="line"><span class="cl">poetry run your-app migrate      <span class="c1"># Database migrations</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="the-result-conversational-database-interactions">The Result: Conversational Database Interactions<a hidden class="anchor" aria-hidden="true" href="#the-result-conversational-database-interactions">#</a></h2>
<p>Once everything is connected, you can have natural conversations with your data:</p>
<p><strong>You</strong>: &ldquo;What are my 3 most recent goals?&rdquo;</p>
<p><strong>Claude</strong>: Looking at your goals, your <strong>3 most recent goals</strong> appear to be:</p>
<p><em>[Calls get_goals with status_filter=&ldquo;active&rdquo;, include_metrics=true]</em></p>
<p>Claude calls the <code>get_goals</code> tool and then analyzes the results to identify the 3 most recently created goals.</p>
<p><strong>Claude</strong>: *Based on your current goals, I found 3 that might need attention.</p>
<p>You could enhance your tool definition to include:</p>
<ul>
<li><code>limit</code> parameter (number of results to return)</li>
<li><code>sort_by</code> parameter (&ldquo;created_at&rdquo;, &ldquo;updated_at&rdquo;, etc.)</li>
</ul>
<p>That would make the call:
<em>[Calls get_goals with limit=3, sort_by=&ldquo;created_at&rdquo;, include_metrics=true]</em></p>
<h2 id="advanced-patterns">Advanced Patterns<a hidden class="anchor" aria-hidden="true" href="#advanced-patterns">#</a></h2>
<h3 id="rich-insights-with-cross-domain-analysis">Rich Insights with Cross-Domain Analysis<a hidden class="anchor" aria-hidden="true" href="#rich-insights-with-cross-domain-analysis">#</a></h3>
<p>Leverage Claude&rsquo;s analytical capabilities:</p>
<p>Instead of asking Claude to run individual queries (&ldquo;show me my goals&rdquo;, &ldquo;show me my metrics&rdquo;), you&rsquo;re giving it rich, interconnected data and letting it find patterns and insights you might miss.</p>
<p><strong>The analytical leap</strong>:</p>
<ul>
<li><strong>Raw approach</strong>: &ldquo;What are my goals?&rdquo; → Claude returns a list</li>
<li><strong>Rich approach</strong>: &ldquo;Here&rsquo;s my goals, metrics, and recent activity - what insights do you see?&rdquo; → Claude identifies trends, correlations, and recommendations</li>
</ul>
<p><strong>Concrete example</strong>: Claude might notice: &ldquo;Your deadlift goal is at 15% progress, but I see you haven&rsquo;t logged any gym sessions in 3 weeks, and your recent check-ins show you&rsquo;ve been deep in learning new technologies. These might be connected - your intense focus on skill development may be crowding out your strength training routine.&rdquo;</p>
<p><strong>Why this is powerful</strong>:</p>
<ul>
<li><strong>Cross-domain thinking</strong> - Claude can spot relationships between different life areas</li>
<li><strong>Pattern recognition</strong> - Finds trends across time and different data types</li>
<li><strong>Proactive insights</strong> - Suggests what to focus on rather than just reporting status</li>
<li><strong>Strategic recommendations</strong> - Not just &ldquo;what happened&rdquo; but &ldquo;what should I do next&rdquo;</li>
</ul>
<p>By connecting the goals app to the LLM, you&rsquo;ve essentially transformed a logging and metrics app into an AI-powered personal strategist that can see the whole picture and help you make better decisions about where to focus your energy.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">handle_progress_summary</span><span class="p">(</span><span class="n">arguments</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Gather data from multiple tables</span>
</span></span><span class="line"><span class="cl">    <span class="n">goals</span> <span class="o">=</span> <span class="n">get_goals_data</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">metrics</span> <span class="o">=</span> <span class="n">get_metrics_data</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl">    <span class="n">recent_activity</span> <span class="o">=</span> <span class="n">get_recent_checkins</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Return rich data for Claude to analyze</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;goals&#34;</span><span class="p">:</span> <span class="n">goals</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;metrics&#34;</span><span class="p">:</span> <span class="n">metrics</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;recent_activity&#34;</span><span class="p">:</span> <span class="n">recent_activity</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;suggested_insights&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Cross-reference goal progress with activity patterns&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Identify goals that haven&#39;t been updated recently&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Find correlation between metrics and goal completion&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="multiple-mcp-servers">Multiple MCP Servers<a hidden class="anchor" aria-hidden="true" href="#multiple-mcp-servers">#</a></h3>
<p>You can run multiple MCP servers for different domains:</p>
<p><strong>Composability</strong> - you can connect multiple specialized servers to Claude simultaneously. Each server can focus on a different domain (your main app, analytics, financial data, etc.), and Claude can use tools from all of them in a single conversation.</p>
<p>Instead of building one monolithic MCP server, you can create focused, single-purpose servers that Claude orchestrates together. Ask Claude to &ldquo;analyze my goals progress and compare it with my financial metrics&rdquo; - it seamlessly pulls from multiple apps to give you cross-system insights.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;mcpServers&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;main-app&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;command&#34;</span><span class="p">:</span> <span class="s2">&#34;poetry&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;args&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;run&#34;</span><span class="p">,</span> <span class="s2">&#34;main-app&#34;</span><span class="p">,</span> <span class="s2">&#34;start-mcp&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;cwd&#34;</span><span class="p">:</span> <span class="s2">&#34;/path/to/main/app&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;analytics-app&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;command&#34;</span><span class="p">:</span> <span class="s2">&#34;poetry&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;args&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;run&#34;</span><span class="p">,</span> <span class="s2">&#34;analytics&#34;</span><span class="p">,</span> <span class="s2">&#34;start-mcp&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;cwd&#34;</span><span class="p">:</span> <span class="s2">&#34;/path/to/analytics/app&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="streaming-responses-for-large-data">Streaming Responses for Large Data<a hidden class="anchor" aria-hidden="true" href="#streaming-responses-for-large-data">#</a></h3>
<p>For large datasets, consider streaming responses:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">handle_large_query</span><span class="p">(</span><span class="n">arguments</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Process in chunks</span>
</span></span><span class="line"><span class="cl">    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">process_in_batches</span><span class="p">(</span><span class="n">query_data</span><span class="p">(</span><span class="n">arguments</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">        <span class="n">results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>  <span class="c1"># Limit response size</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;results&#34;</span><span class="p">:</span> <span class="n">results</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;truncated&#34;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;total_available&#34;</span><span class="p">:</span> <span class="n">get_total_count</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="common-issues-and-solutions">Common Issues and Solutions<a hidden class="anchor" aria-hidden="true" href="#common-issues-and-solutions">#</a></h2>
<h3 id="1-poetry-could-not-find-pyprojecttoml">1. &ldquo;Poetry could not find pyproject.toml&rdquo;<a hidden class="anchor" aria-hidden="true" href="#1-poetry-could-not-find-pyprojecttoml">#</a></h3>
<p><strong>Error</strong>: MCP server can&rsquo;t find your project files.</p>
<p><strong>Solution</strong>: Configuration probably has the wrong directory. Use shell wrapper with explicit directory change:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;command&#34;</span><span class="p">:</span> <span class="s2">&#34;/bin/bash&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;args&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;-c&#34;</span><span class="p">,</span> <span class="s2">&#34;cd /full/path/to/project &amp;&amp; poetry run your-command&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2-relation-table_name-does-not-exist">2. &ldquo;relation &rsquo;table_name&rsquo; does not exist&rdquo;<a hidden class="anchor" aria-hidden="true" href="#2-relation-table_name-does-not-exist">#</a></h3>
<p><strong>Error</strong>: Database tables not created.</p>
<p><strong>Solution</strong>: You likely forgot to run a migration - run migrations before starting MCP server:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">poetry run alembic upgrade head
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="3-json-parsing-errors-in-claude-logs">3. JSON Parsing Errors in Claude Logs<a hidden class="anchor" aria-hidden="true" href="#3-json-parsing-errors-in-claude-logs">#</a></h3>
<p><strong>Error</strong>: Unexpected non-whitespace character after JSON</p>
<p><strong>Cause</strong>: SQLAlchemy debug output mixing with JSON responses.</p>
<p><strong>Solution</strong>: Either disable SQLAlchemy echo or ignore these warnings:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="n">DATABASE_URL</span><span class="p">,</span> <span class="n">echo</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># Disable in production</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="4-module-import-warnings">4. Module Import Warnings<a hidden class="anchor" aria-hidden="true" href="#4-module-import-warnings">#</a></h3>
<p><strong>Warning</strong>: RuntimeWarning: &lsquo;module&rsquo; found in sys.modules</p>
<p><strong>Solution</strong>: This warning is harmless when running MCP servers. It occurs due to Python&rsquo;s module loading order but doesn&rsquo;t affect functionality.</p>
<h2 id="debugging-mcp-connections">Debugging MCP Connections<a hidden class="anchor" aria-hidden="true" href="#debugging-mcp-connections">#</a></h2>
<p><strong>View MCP logs</strong>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">tail -f ~/Library/Logs/Claude/mcp-server-your-app-name.log
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Test MCP server manually</strong>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> /your/project/path
</span></span><span class="line"><span class="cl">poetry run python -m src.core.mcp.server
</span></span><span class="line"><span class="cl"><span class="c1"># Should wait for input without errors</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Add debug output to MCP handlers</strong>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">handle_tool</span><span class="p">(</span><span class="n">arguments</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Your logic here</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="n">process_data</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># This appears in Claude logs</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Debug: Tool failed with </span><span class="si">{</span><span class="n">arguments</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="sa">f</span><span class="s2">&#34;Error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="conclusion">Conclusion<a hidden class="anchor" aria-hidden="true" href="#conclusion">#</a></h2>
<p>Building MCP-enabled applications opens up imaginative possibilities for AI interactions and augmentation - transforming static applications into intelligent partners that can analyze, strategize, and evolve with your needs. The combination of Pydantic&rsquo;s type safety, FastAPI&rsquo;s performance, PostgreSQL&rsquo;s robustness, and MCP&rsquo;s conversational interface creates a powerful foundation for intelligent applications.</p>
<h3 id="key-takeaways">Key takeaways:<a hidden class="anchor" aria-hidden="true" href="#key-takeaways">#</a></h3>
<ul>
<li><strong>Pydantic models</strong> provide type safety across your entire stack</li>
<li><strong>MCP integration</strong> is surprisingly straightforward once you understand the stdio communication pattern</li>
<li><strong>Error handling and logging</strong> are crucial for debugging MCP connections</li>
<li><strong>The development experience</strong> is smooth with proper tooling and CLI commands</li>
<li><strong>Standardized AI integration</strong> - MCP provides the protocol layer that lets any LLM interact with your applications through well-defined tools</li>
</ul>
<p>The result is a system that enables natural conversations with your data, allows you to create complex queries through simple language, and provides intelligent insights.</p>
<p><strong>Next steps</strong>: The patterns demonstrated here extend naturally to production environments with proper authentication, advanced tool chaining, and rich user interfaces. The future of AI application development leverages LLM advances to unlock the full potential of our applications, transforming them from static data repositories with APIs into dynamic, intelligent partners.</p>
<hr>
<p><strong>Built with</strong>: Python 3.12, FastAPI, PostgreSQL, Pydantic, SQLAlchemy, Alembic, and Anthropic&rsquo;s MCP</p>
<p><strong>About the Author</strong>: Mark Holton is a hands-on Software Architect at ShiftUp, where we&rsquo;re building AI agents that revolutionize Go To Market and Sales Intelligence.</p>
<hr>
<p><em>Originally published to Medium: <a href="https://markholton.medium.com/ai-integration-building-conversational-apps-with-mcp-f47a487009f5">https://markholton.medium.com/ai-integration-building-conversational-apps-with-mcp-f47a487009f5</a></em></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/ai/">AI</a></li>
      <li><a href="http://localhost:1313/tags/mcp/">MCP</a></li>
      <li><a href="http://localhost:1313/tags/python/">Python</a></li>
      <li><a href="http://localhost:1313/tags/fastapi/">FastAPI</a></li>
      <li><a href="http://localhost:1313/tags/postgresql/">PostgreSQL</a></li>
      <li><a href="http://localhost:1313/tags/claude/">Claude</a></li>
      <li><a href="http://localhost:1313/tags/conversational-ai/">Conversational AI</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/posts/hello-world/">
    <span class="title">« Prev</span>
    <br>
    <span>On the board with Hugo</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share AI Integration: Building Conversational Apps with MCP on x"
            href="https://x.com/intent/tweet/?text=AI%20Integration%3a%20Building%20Conversational%20Apps%20with%20MCP&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fmcp_blog_post%2f&amp;hashtags=AI%2cMCP%2cPython%2cFastAPI%2cPostgreSQL%2cClaude%2cConversationalAI">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share AI Integration: Building Conversational Apps with MCP on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fmcp_blog_post%2f&amp;title=AI%20Integration%3a%20Building%20Conversational%20Apps%20with%20MCP&amp;summary=AI%20Integration%3a%20Building%20Conversational%20Apps%20with%20MCP&amp;source=http%3a%2f%2flocalhost%3a1313%2fposts%2fmcp_blog_post%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share AI Integration: Building Conversational Apps with MCP on reddit"
            href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fposts%2fmcp_blog_post%2f&title=AI%20Integration%3a%20Building%20Conversational%20Apps%20with%20MCP">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share AI Integration: Building Conversational Apps with MCP on telegram"
            href="https://telegram.me/share/url?text=AI%20Integration%3a%20Building%20Conversational%20Apps%20with%20MCP&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fmcp_blog_post%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
</ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">Mark Holton - Hands on Software Architect</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
